import os
from src.core.video_clip import create_video

def test_create_video_with_captions():

    tmp_dir = '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893';
    # 准备测试数据
    caption_list = [{'text': '当我们恋爱时，我们心目中正在寻找一个理想的丈夫或理想的妻子。', 'keys': 'Love, ideal, husband, wife', 'end_time': 6055, 'begin_time': 160, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076894_Love,_ideal,_husband,_wife_0.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076894_Love,_ideal,_husband,_wife_1.jpg'], 'start_time': 0, 'duration': 6.061}, {'text': '没错，我们带着这样一个美好的愿望，但这个愿望就是我们在心中自己构建了一种如柏拉图所说的理念。', 'keys': 'Beauty, desire, construction, idea, Plato', 'end_time': 14724, 'begin_time': 6061, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076895_Beauty,_desire,_construction,_idea,_Plato_0.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076895_Beauty,_desire,_construction,_idea,_Plato_1.jpg'], 'start_time': 6.061, 'duration': 8.669}, {'text': '我带着关于怎样的气质才是理想的气质的想法追求了那个女性，我也许带着怎样的丈夫是理想的丈夫的愿望来追求了一个男性。', 'keys': 'Temperament, ideal, female, male, husband', 'end_time': 25402, 'begin_time': 14730, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076896_Temperament,_ideal,_female,_male,_husband_0.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076896_Temperament,_ideal,_female,_male,_husband_1.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076897_Temperament,_ideal,_female,_male,_husband_2.jpg'], 'start_time': 14.73, 'duration': 10.695999999999998}, {'text': '然后他们终于结合了，每个人带着一个实体做标准。', 'keys': 'Combination, entity, standard', 'end_time': 29300, 'begin_time': 25426, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076897_Combination,_entity,_standard_0.jpg'], 'start_time': 25.426, 'duration': 4.154}, {'text': '来衡量对方，这个错误错在哪里。', 'keys': 'Measure, the other, the error', 'end_time': 32513, 'begin_time': 29580, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076898_Measure,_the_other,_the_error_0.jpg'], 'start_time': 29.58, 'duration': 2.933}, {'text': '实际上，没有一个女性天生就是妻子，也没有一个男性天生就是丈夫。', 'keys': 'Female, born, wife, male, husband', 'end_time': 39509, 'begin_time': 32513, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076899_Female,_born,_wife,_male,_husband_0.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076899_Female,_born,_wife,_male,_husband_1.jpg'], 'start_time': 32.513, 'duration': 6.996000000000002}, {'text': '没有天生的丈夫或妻子，丈夫和妻子是通过相互作用形成的，这种关系叫缘。', 'keys': 'Nature, husband, wife, interaction, relationship, destiny', 'end_time': 51470, 'begin_time': 39509, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076900_Nature,_husband,_wife,_interaction,_relationship,_destiny_0.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076900_Nature,_husband,_wife,_interaction,_relationship,_destiny_1.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076901_Nature,_husband,_wife,_interaction,_relationship,_destiny_2.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076902_Nature,_husband,_wife,_interaction,_relationship,_destiny_3.jpg'], 'start_time': 39.509, 'duration': 12.271}, {'text': '我就是一个最标准的丈夫。', 'keys': 'Standard, husband', 'end_time': 54230, 'begin_time': 51780, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076902_Standard,_husband_0.jpg'], 'start_time': 51.78, 'duration': 2.740000000000002}, {'text': '向你走来，没有这个事情，我等待你把我做成丈夫。', 'keys': 'Wait, make it, husband', 'end_time': 59000, 'begin_time': 54520, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076903_Wait,_make_it,_husband_0.jpg'], 'start_time': 54.52, 'duration': 4.779999999999994}, {'text': '喂，你也不是作为一个标准的妻子向我走来，你等着我把你做成妻子，是不是？', 'keys': 'Standard, wife, make it', 'end_time': 64840, 'begin_time': 59300, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076904_Standard,_wife,_make_it_0.jpg'], 'start_time': 59.3, 'duration': 5.820000000000007}, {'text': '当我儿子诞生的那一天，我知道他把我也生出来了，他把我作为父亲生出来了。', 'keys': 'Son, born, father', 'end_time': 71160, 'begin_time': 65120, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076904_Son,_born,_father_0.jpg', '/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076905_Son,_born,_father_1.jpg'], 'start_time': 65.12, 'duration': 6.319999999999993}, {'text': '比如我们只是再生一个儿子，是吧？', 'keys': 'Born again, son', 'end_time': 73820, 'begin_time': 71440, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076905_Born_again,_son_0.jpg'], 'start_time': 71.44, 'duration': 2.6599999999999966}, {'text': '儿子把我们作为父亲或者母亲也生出来了。', 'keys': 'Son, father, mother', 'end_time': 77280, 'begin_time': 74100, 'image_paths': ['/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/1732076906_Son,_father,_mother_0.jpg'], 'start_time': 74.1, 'duration': 3.180000000000007}]
    
    audio_path = "/Users/yue/PycharmProjects/video-clip/tmp/clip_tmp_1732076893/temp_media_1732076906.wav"

    bgm_path = "/Users/yue/PycharmProjects/video-clip/static/bg_music.mp3"

    # 调用被测试的函数
    create_video("【王德峰】讲透了夫妻关系", f'{tmp_dir}/cover.jpg', caption_list, audio_path, tmp_dir, bgm_path)
    
    print("测试通过：视频创建成功！")
    return True
        

if __name__ == "__main__":
    test_create_video_with_captions() 